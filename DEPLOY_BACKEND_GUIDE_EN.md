# 🚀 Backend Deployment Guide - RiskGuardian AI

## 📋 **EXECUTIVE SUMMARY**

This guide provides complete instructions for deploying the RiskGuardian AI backend to production using **Railway** (recommended) or alternatives.

### **✅ CURRENT STATUS:**
- 🔨 Backend successfully compiled
- 📦 Dependencies verified
- 🎯 Architecture: Node.js + TypeScript + Express + PostgreSQL + Redis
- 🌐 Ready for production deployment

---

## 🎯 **OPTION 1: RAILWAY (RECOMMENDED)**

### **Why Railway?**
- ✅ PostgreSQL and Redis included automatically
- ✅ Automatic deployment via GitHub
- ✅ Simple configuration
- ✅ Real-time logs
- ✅ Automatic scalability

### **📋 STEP BY STEP - RAILWAY:**

#### **1. Preparation (✅ ALREADY DONE)**
```bash
# Already executed:
✅ npm install
✅ npm run build
✅ Configuration files created (railway.json, Procfile)
```

#### **2. Create Railway Account**
1. Access: https://railway.app
2. Click "Start a New Project"
3. Connect your GitHub account
4. Select "Deploy from GitHub repo"
5. Choose: `riskguardian-ai`

#### **3. Configure Project**
```
✅ Root Directory: /backend
✅ Build Command: npm run build
✅ Start Command: npm run start
```

#### **4. Add Services**
In Railway panel, add:
- 🗄️ **PostgreSQL**: Click "+ Add Service" → PostgreSQL
- 🔴 **Redis**: Click "+ Add Service" → Redis

#### **5. Configure Environment Variables**
In Railway panel, go to "Variables" and add:

```bash
# Essential (REQUIRED)
NODE_ENV=production
PORT=${{RAILWAY_PUBLIC_PORT}}
DATABASE_URL=${{DATABASE_URL}}  # Auto-generated by Railway
REDIS_URL=${{REDIS_URL}}        # Auto-generated by Railway

# Frontend (ADJUST TO YOUR VERCEL URL)
FRONTEND_URL=https://riskguardian-7ewwn3tg2-jistrianes-projects.vercel.app
ALLOWED_ORIGINS=https://riskguardian-7ewwn3tg2-jistrianes-projects.vercel.app

# Security
JWT_SECRET=riskguardian-super-secret-jwt-key-production-2024-32chars-minimum
JWT_EXPIRES_IN=7d

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Blockchain (Sepolia Testnet)
SEPOLIA_CHAIN_ID=11155111
SEPOLIA_RPC_URL=https://sepolia.drpc.org

# Logging
LOG_LEVEL=info
```

#### **6. Deploy**
1. In Railway, click "Deploy"
2. Wait for build (1-3 minutes)
3. Access generated URL: `https://your-app.railway.app`

---

## 🔵 **OPTION 2: HEROKU (ALTERNATIVE)**

### **📋 STEP BY STEP - HEROKU:**

#### **1. Install Heroku CLI**
```bash
# Ubuntu/Debian
curl https://cli-assets.heroku.com/install.sh | sh

# macOS
brew tap heroku/brew && brew install heroku
```

#### **2. Login and Create App**
```bash
heroku login
heroku create riskguardian-backend

# Add add-ons
heroku addons:create heroku-postgresql:essential-0
heroku addons:create heroku-redis:mini
```

#### **3. Configure Variables**
```bash
heroku config:set NODE_ENV=production
heroku config:set JWT_SECRET=riskguardian-super-secret-jwt-key-production-2024-32chars-minimum
heroku config:set FRONTEND_URL=https://riskguardian-7ewwn3tg2-jistrianes-projects.vercel.app
heroku config:set ALLOWED_ORIGINS=https://riskguardian-7ewwn3tg2-jistrianes-projects.vercel.app
heroku config:set SEPOLIA_RPC_URL=https://sepolia.drpc.org
heroku config:set SEPOLIA_CHAIN_ID=11155111
```

#### **4. Deploy**
```bash
cd backend
git init
heroku git:remote -a riskguardian-backend
git add .
git commit -m "Deploy RiskGuardian Backend"
git push heroku main
```

---

## 🟣 **OPTION 3: RENDER (SIMPLE)**

1. Access: https://render.com
2. Connect GitHub
3. New → Web Service
4. Repository: `riskguardian-ai`
5. Root Directory: `backend`
6. Build Command: `npm run build`
7. Start Command: `npm start`
8. Add PostgreSQL: New → PostgreSQL
9. Configure environment variables

---

## ⚙️ **POST-DEPLOYMENT CONFIGURATIONS**

### **1. Verify API Health**
```bash
curl https://your-backend-url.railway.app/health
```

**Expected response:**
```json
{
  "status": "ok",
  "message": "RiskGuardian AI Backend",
  "version": "1.0.0",
  "timestamp": "2024-06-20T11:00:00.000Z",
  "uptime": 123.45
}
```

### **2. Test Main Endpoints**
```bash
# Root endpoint
curl https://your-backend-url.railway.app/

# API routes
curl https://your-backend-url.railway.app/api/auth/nonce/0x123...
```

### **3. Configure CORS in Frontend**
In frontend, update API configuration file:

```typescript
// frontend/src/services/api.service.ts
const API_BASE_URL = process.env.NODE_ENV === 'production' 
  ? 'https://your-backend-url.railway.app/api'
  : 'http://localhost:3001/api';
```

### **4. Migrate Database**
Prisma will automatically execute migrations on first deploy via Procfile.

---

## 🛠️ **ENVIRONMENT CONFIGURATIONS**

### **🔴 REQUIRED VARIABLES:**
```bash
NODE_ENV=production
DATABASE_URL=postgresql://...
REDIS_URL=redis://...
JWT_SECRET=min-32-characters
FRONTEND_URL=https://your-frontend.vercel.app
```

### **🟡 OPTIONAL VARIABLES:**
```bash
SEPOLIA_PRIVATE_KEY=         # For blockchain transactions
COINMARKETCAP_API_KEY=       # For market data
COINGECKO_API_KEY=          # Alternative for data
LOG_LEVEL=info              # Log level
```

---

## 🔧 **USEFUL MONITORING COMMANDS**

### **Railway:**
```bash
# View logs
railway logs

# Open app
railway open

# Status
railway status
```

### **Heroku:**
```bash
# View logs
heroku logs --tail -a riskguardian-backend

# Status
heroku ps -a riskguardian-backend

# Restart
heroku restart -a riskguardian-backend
```

---

## 🎯 **FINAL CHECKLIST**

- [ ] ✅ Backend successfully deployed
- [ ] ✅ API `/health` responding
- [ ] ✅ PostgreSQL database connected
- [ ] ✅ Redis working
- [ ] ✅ CORS configured for frontend
- [ ] ✅ Logs without critical errors
- [ ] ✅ Frontend updated with new API URL

---

## 🚨 **TROUBLESHOOTING**

### **Problem: API not responding**
```bash
# Check logs
railway logs
# or
heroku logs --tail
```

### **Problem: CORS error**
- Check `FRONTEND_URL` in environment variables
- Confirm Vercel URL in `ALLOWED_ORIGINS`

### **Problem: Database not connecting**
- Check `DATABASE_URL` 
- Confirm PostgreSQL is running

### **Problem: Build fails**
```bash
# Clean and rebuild
npm run clean
npm run build
```

---

## 📞 **NEXT STEPS**

1. **Execute deployment** following one of the options above
2. **Test API** with provided commands
3. **Update frontend** with new URL
4. **Monitor logs** to ensure stability
5. **Configure monitoring** (Sentry, LogRocket, etc.)

---

**🎉 Your RiskGuardian AI backend will be running in production in a few minutes!** 